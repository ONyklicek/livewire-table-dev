# Laravel Advanced Table System üìä

Pokroƒçil√Ω, plnƒõ objektov√Ω a server-driven tabulkov√Ω syst√©m pro Laravel s Livewire 3, Alpine.js a Tailwind CSS.

## üéØ Vlastnosti

- ‚úÖ **SDUI (Server-Driven UI)** - V≈°e konfigurovateln√© z PHP
- ‚úÖ **Inline Editing** - √öprava p≈ô√≠mo v bu≈àk√°ch tabulky
- ‚úÖ **Grouping** - Seskupov√°n√≠ ≈ô√°dk≈Ø s collapsible groups
- ‚úÖ **Sub-rows** - Expandable vno≈ôen√Ω obsah
- ‚úÖ **Column Toggle** - Dynamick√© skr√Ωv√°n√≠/zobrazov√°n√≠ sloupc≈Ø
- ‚úÖ **Saved Filters** - Ulo≈æen√© kombinace filtr≈Ø
- ‚úÖ **Relationships** - Podpora dot notation (`company.name`)
- ‚úÖ **Enum Support** - Automatick√° detekce PHP enums
- ‚úÖ **Responsive** - Mobile/Tablet/Desktop optimalizace
- ‚úÖ **Sorting & Filtering** - Per-column i glob√°ln√≠
- ‚úÖ **Bulk Actions** - Hromadn√© operace
- ‚úÖ **Live Updates** - Auto-refresh ka≈æd√Ωch N sekund
- ‚úÖ **Htmlable** - Pln√° podpora `__toString()` a `toHtml()`

---

## üì¶ Instalace

### 1. Zkop√≠ruj soubory

```
app/
‚îú‚îÄ‚îÄ Support/
‚îÇ   ‚îî‚îÄ‚îÄ Tables/
‚îÇ       ‚îú‚îÄ‚îÄ Table.php
‚îÇ       ‚îú‚îÄ‚îÄ Builders/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ QueryBuilder.php
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ RelationshipResolver.php
‚îÇ       ‚îú‚îÄ‚îÄ Columns/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Column.php
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ TextColumn.php
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ BadgeColumn.php
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ ImageColumn.php
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ EditableColumn.php
‚îÇ       ‚îú‚îÄ‚îÄ Filters/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Filter.php
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ TextFilter.php
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ SelectFilter.php
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ DateFilter.php
‚îÇ       ‚îú‚îÄ‚îÄ Actions/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Action.php
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ BulkAction.php
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ Modal.php
‚îÇ       ‚îî‚îÄ‚îÄ Concerns/
‚îÇ           ‚îú‚îÄ‚îÄ HasColumns.php
‚îÇ           ‚îú‚îÄ‚îÄ HasFilters.php
‚îÇ           ‚îú‚îÄ‚îÄ HasActions.php
‚îÇ           ‚îú‚îÄ‚îÄ HasPagination.php
‚îÇ           ‚îú‚îÄ‚îÄ HasResponsiveScheme.php
‚îÇ           ‚îú‚îÄ‚îÄ HasGrouping.php
‚îÇ           ‚îú‚îÄ‚îÄ HasSubRows.php
‚îÇ           ‚îú‚îÄ‚îÄ HasColumnToggle.php
‚îÇ           ‚îî‚îÄ‚îÄ HasSavedFilters.php
‚îú‚îÄ‚îÄ Livewire/
‚îÇ   ‚îî‚îÄ‚îÄ Concerns/
‚îÇ       ‚îî‚îÄ‚îÄ HasTable.php
‚îî‚îÄ‚îÄ Models/
    ‚îî‚îÄ‚îÄ TableFilterPreset.php (optional)
```

### 2. Spus≈• migraci (pro Saved Filters)

```bash
php artisan make:migration create_table_filter_presets_table
```

```php
Schema::create('table_filter_presets', function (Blueprint $table) {
    $table->id();
    $table->foreignId('user_id')->constrained()->cascadeOnDelete();
    $table->string('table_name');
    $table->string('name');
    $table->json('filters');
    $table->boolean('is_default')->default(false);
    $table->timestamps();
    
    $table->index(['user_id', 'table_name']);
});
```

```bash
php artisan migrate
```

### 3. Nainstaluj dependencies

```bash
npm install
```

### 4. Aktualizuj Tailwind config

```js
// tailwind.config.js
export default {
    content: [
        './resources/**/*.blade.php',
        './app/Support/Tables/**/*.php',
    ],
    safelist: [
        // Badge colors
        'bg-green-100', 'text-green-800', 'ring-green-600/20', 'fill-green-500',
        'bg-red-100', 'text-red-800', 'ring-red-600/20', 'fill-red-500',
        'bg-yellow-100', 'text-yellow-800', 'ring-yellow-600/20', 'fill-yellow-500',
        'bg-blue-100', 'text-blue-800', 'ring-blue-600/20', 'fill-blue-500',
        'bg-gray-100', 'text-gray-800', 'ring-gray-600/20', 'fill-gray-500',
        'bg-orange-100', 'text-orange-800', 'ring-orange-600/20', 'fill-orange-500',
        'bg-purple-100', 'text-purple-800', 'ring-purple-600/20', 'fill-purple-500',
    ],
}
```

---

## üöÄ Z√°kladn√≠ pou≈æit√≠

### 1. Vytvo≈ô Livewire komponentu

```bash
php artisan make:livewire UsersTable
```

### 2. Implementuj tabulku

```php
<?php

namespace App\Livewire;

use App\Models\User;
use App\Support\Tables\Table;
use App\Support\Tables\Columns\TextColumn;
use App\Support\Tables\Columns\BadgeColumn;
use App\Support\Tables\Filters\TextFilter;
use App\Support\Tables\Filters\SelectFilter;
use App\Support\Tables\Actions\Action;
use App\Support\Tables\Actions\BulkAction;
use Livewire\Component;
use Livewire\WithPagination;

class UsersTable extends Component
{
    use WithPagination;
    use \App\Livewire\Concerns\HasTable;

    public function table(Table $table): Table
    {
        return $table
            ->model(User::query())
            ->columns([
                TextColumn::make('name')
                    ->label('Jm√©no')
                    ->searchable()
                    ->sortable(),
                
                TextColumn::make('email')
                    ->label('Email')
                    ->searchable()
                    ->sortable(),
                
                BadgeColumn::make('status')
                    ->label('Status')
                    ->colors([
                        'active' => 'green',
                        'inactive' => 'gray',
                    ])
                    ->sortable(),
            ])
            ->filters([
                TextFilter::make('name_filter', 'name')
                    ->label('Jm√©no')
                    ->placeholder('Hledat...'),
                
                SelectFilter::make('status_filter', 'status')
                    ->label('Status')
                    ->options([
                        'active' => 'Aktivn√≠',
                        'inactive' => 'Neaktivn√≠',
                    ]),
            ])
            ->actions([
                Action::make('edit')
                    ->label('Upravit')
                    ->color('blue')
                    ->action(fn($record) => $this->redirect(route('users.edit', $record))),
            ])
            ->perPage(25);
    }

    public function render()
    {
        return view('livewire.users-table');
    }
}
```

### 3. Vytvo≈ô Blade view

```blade
{{-- resources/views/livewire/users-table.blade.php --}}

<div>
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-2xl font-bold mb-6">U≈æivatel√©</h1>
        
        {!! $this->tableHtml !!}
    </div>
</div>
```

### 4. Pou≈æij v route nebo view

```php
Route::get('/users', UsersTable::class);
```

---

## üìò Dokumentace

### Columns (Sloupce)

#### TextColumn

Z√°kladn√≠ textov√Ω sloupec.

```php
TextColumn::make('name')
    ->label('Jm√©no')
    ->searchable()
    ->sortable()
    ->copyable()  // P≈ôid√° tlaƒç√≠tko pro kop√≠rov√°n√≠
    ->limit(50)   // O≈ô√≠zne text na 50 znak≈Ø
    ->placeholder('‚Äî')  // Zobraz√≠ kdy≈æ je hodnota null
    ->hideOn(['sm', 'md'])  // Skryje na mobilech a tabletech
    ->format(fn($value) => strtoupper($value))  // Custom form√°tov√°n√≠
```

#### BadgeColumn

Barevn√© badge pro stavy.

```php
BadgeColumn::make('status')
    ->label('Status')
    ->colors([
        'active' => 'green',
        'inactive' => 'gray',
        'suspended' => 'red',
        'pending' => 'yellow',
    ])
    ->icons([
        'active' => '<circle cx="3" cy="3" r="3" />',
        'suspended' => '<path d="M6 18L18 6M6 6l12 12"/>',
    ])
    ->format(fn($value) => match($value) {
        true, 1 => 'Aktivn√≠',
        false, 0 => 'Neaktivn√≠',
        default => 'Nezn√°m√Ω'
    })
```

#### ImageColumn

Sloupcec pro obr√°zky.

```php
ImageColumn::make('avatar')
    ->label('Avatar')
    ->circular()  // Kulat√Ω obr√°zek
    ->size('md')  // sm, md, lg
    ->defaultImage('https://ui-avatars.com/api/?name=User')
```

#### EditableColumn

Editovateln√Ω sloupec p≈ô√≠mo v tabulce.

```php
EditableColumn::make('name')
    ->label('Jm√©no')
    ->inputType('text')  // text, number, select, date, textarea
    ->rules('required|min:3')
    ->options([  // Pro select
        'option1' => 'Label 1',
        'option2' => 'Label 2',
    ])
    ->onSave(function ($record, $value) {
        $record->update(['name' => $value]);
        $this->dispatch('notify', ['message' => 'Ulo≈æeno']);
    })
```

#### Custom Column

```php
use App\Support\Tables\Columns\Column;

class MyColumn extends Column
{
    public function formatValue(mixed $value, Model $record): mixed
    {
        return strtoupper($value);
    }
    
    public function render(): string
    {
        return view('components.table.columns.my-column', [
            'column' => $this,
            'record' => $this->record,
            'value' => $this->getFormattedValue($this->record),
        ])->render();
    }
}
```

---

### Relationships (Vztahy)

Podporov√°no pomoc√≠ **dot notation**:

```php
// Jednoduch√Ω vztah
TextColumn::make('department.name')
    ->label('Oddƒõlen√≠')
    ->searchable()
    ->sortable()

// Vno≈ôen√Ω vztah
TextColumn::make('user.company.name')
    ->label('Firma')

// Automatick√Ω eager loading
// RelationshipResolver automaticky naƒçte relationships
```

---

### Filters (Filtry)

#### TextFilter

```php
TextFilter::make('name_filter', 'name')
    ->label('Jm√©no')
    ->placeholder('Hledat...')
    ->operator('like')  // like, =, !=, >, <, >=, <=
```

#### SelectFilter

```php
SelectFilter::make('status_filter', 'status')
    ->label('Status')
    ->options([
        'active' => 'Aktivn√≠',
        'inactive' => 'Neaktivn√≠',
    ])
    ->placeholder('Vyberte status')
```

#### DateFilter

```php
DateFilter::make('created_after', 'created_at')
    ->label('Od data')
    ->operator('>=')
```

#### Global Filters

Filtry ve dropdown menu:

```php
->globalFilters([
    SelectFilter::make('department_id', 'department.id')
        ->label('Oddƒõlen√≠')
        ->options(Department::pluck('name', 'id'))
        ->global(),
])
```

#### Filtry pro relationships

```php
TextFilter::make('company_name', 'company.name')
    ->label('Firma')
    ->placeholder('Hledat firmu...')
```

---

### Actions (Akce)

#### Jednoduch√° akce

```php
Action::make('edit')
    ->label('Upravit')
    ->icon('<path d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5"/>') 
    ->color('blue')
    ->action(function ($record) {
        return redirect()->route('users.edit', $record);
    })
```

#### Akce s potvrzen√≠m

```php
Action::make('delete')
    ->label('Smazat')
    ->color('red')
    ->requireConfirmation(
        'Smazat u≈æivatele?',
        'Tato akce je nevratn√°.'
    )
    ->action(function ($record) {
        $record->delete();
    })
```

#### Akce s mod√°lem

```php
use App\Support\Tables\Actions\Modal;

Action::make('details')
    ->label('Detail')
    ->modal(
        Modal::make('Detail u≈æivatele')
            ->info('Zde jsou detailn√≠ informace')
            ->size('lg')  // sm, md, lg, xl, full
    )
```

---

### Bulk Actions (Hromadn√© akce)

```php
->bulkActions([
    BulkAction::make('activate')
        ->label('Aktivovat vybran√©')
        ->color('green')
        ->action(function ($records) {
            $records->each->update(['status' => 'active']);
        }),
    
    BulkAction::make('delete')
        ->label('Smazat vybran√©')
        ->color('red')
        ->requireConfirmation()
        ->action(function ($records) {
            $records->each->delete();
        }),
])
```

---

### Grouping (Seskupov√°n√≠)

```php
->groupBy('department.name')
->groupHeader(function ($key, $items) {
    return sprintf('%s (%d u≈æivatel≈Ø)', $key, $items->count());
})
->collapsibleGroups(true)
```

**S custom logikou:**

```php
->groupBy('created_at', function ($item) {
    return $item->created_at->format('Y-m');
})
->groupHeader(function ($key, $items) {
    $total = $items->sum('salary');
    return "$key - Celkem: " . number_format($total) . " Kƒç";
})
```

---

### Sub-rows (Vno≈ôen√© ≈ô√°dky)

```php
->subRows('posts', function ($posts, $user) {
    return view('tables.user-posts', [
        'posts' => $posts,
        'user' => $user,
    ])->render();
})
->lazyLoadSubRows(true)
```

**Sub-row view p≈ô√≠klad:**

```blade
{{-- resources/views/tables/user-posts.blade.php --}}

<div class="space-y-2">
    <h4 class="font-semibold">P≈ô√≠spƒõvky ({{ $posts->count() }})</h4>
    @foreach($posts as $post)
        <div class="bg-white border rounded p-3">
            <h5>{{ $post->title }}</h5>
            <p class="text-sm text-gray-600">{{ $post->excerpt }}</p>
        </div>
    @endforeach
</div>
```

---

### Column Toggle (Skr√Ωv√°n√≠ sloupc≈Ø)

```php
->enableColumnToggle(true)
->alwaysVisible(['name', 'email'])  // Tyto sloupce nelze skr√Ωt
```

U≈æivatel pak m≈Ø≈æe v UI kliknout na "Sloupce" a vybrat, kter√© chce vidƒõt.

---

### Saved Filters (Ulo≈æen√© filtry)

```php
->enablePresets(true)
```

**U≈æivatel pak m≈Ø≈æe:**
- Ulo≈æit aktu√°ln√≠ kombinaci filtr≈Ø
- Naƒç√≠st ulo≈æen√© filtry
- Smazat filtry
- Nastavit defaultn√≠ preset

**Programaticky:**

```php
// V Livewire komponentƒõ
public function saveMyPreset()
{
    $this->savePreset('Aktivn√≠ u≈æivatel√©', [
        'status' => 'active',
        'department_id' => 1,
    ], isDefault: true);
}
```

---

### Responsive Design

```php
->scheme([
    'mobile' => ['stack'],   // Karty m√≠sto tabulky
    'tablet' => ['scroll'],  // Horizont√°ln√≠ scroll
    'desktop' => ['full'],   // Pln√° tabulka
])
```

**Per-column responsive:**

```php
TextColumn::make('description')
    ->hideOn(['sm', 'md'])  // Skryj na mobilu a tabletu
```

---

### Live Updates

```php
->liveUpdate(60)  // Auto-refresh ka≈æd√Ωch 60 sekund
```

---

### Pagination

```php
->perPage(25)
->pageOptions([10, 25, 50, 100])
```

---

## üé® Styling & Theming

### Tailwind Safelist

Pro dynamick√© barvy v badges mus√≠≈° p≈ôidat do `safelist`:

```js
safelist: [
    'bg-green-100', 'text-green-800', 'ring-green-600/20',
    'bg-red-100', 'text-red-800', 'ring-red-600/20',
    // ... dal≈°√≠ barvy
]
```

### Custom Views

Ka≈æd√Ω column m≈Ø≈æe m√≠t vlastn√≠ view:

```php
TextColumn::make('name')
    ->view('components.table.columns.custom-text')
```

```blade
{{-- resources/views/components/table/columns/custom-text.blade.php --}}

<div class="custom-styling">
    <strong>{{ $value }}</strong>
</div>
```

---

## üîß Pokroƒçil√© funkce

### QueryBuilder Pattern

Syst√©m pou≈æ√≠v√° `QueryBuilder` pro ƒçist≈°√≠ query konstrukci:

```php
use App\Support\Tables\Builders\QueryBuilder;
use App\Support\Tables\Builders\RelationshipResolver;

// Automatick√Ω eager loading
$relationships = RelationshipResolver::extractRelationships($columns);
$query = RelationshipResolver::eagerLoad($query, $relationships);

// Fluent API
$queryBuilder = new QueryBuilder($query);
$queryBuilder
    ->search(['name', 'email'], 'john')
    ->multiSort(['name' => 'asc', 'created_at' => 'desc']);
```

### Custom Filters

```php
use App\Support\Tables\Filters\Filter;

class CustomFilter extends Filter
{
    public function apply(Builder $query, mixed $value): Builder
    {
        return $query->where('custom_field', $value);
    }
    
    public function render(): string
    {
        return view('filters.custom', ['filter' => $this])->render();
    }
}
```

### Enum Support

Automatick√° detekce PHP 8.1+ enums:

```php
// Model
enum UserStatus: string
{
    case ACTIVE = 'active';
    case INACTIVE = 'inactive';
}

protected $casts = [
    'status' => UserStatus::class,
];

// Table
BadgeColumn::make('status')
    ->colors([
        'active' => 'green',
        'inactive' => 'gray',
    ])
    ->format(fn($value) => $value instanceof BackedEnum 
        ? $value->value 
        : $value
    )
```

### Hidden Columns

```php
TextColumn::make('internal_notes')
    ->hidden(!auth()->user()->isAdmin())

TextColumn::make('debug_info')
    ->hidden(fn() => !config('app.debug'))
```

---

## üêõ Troubleshooting

### Probl√©m: "Object could not be converted to string"

**≈òe≈°en√≠:** Pou≈æij `{!! $this->tableHtml !!}` m√≠sto `{!! $this->table !!}`

### Probl√©m: "Undefined variable $tableSearch"

**≈òe≈°en√≠:** Zkontroluj, ≈æe Table::render() p≈ôed√°v√° v≈°echny pot≈ôebn√© promƒõnn√© do view.

### Probl√©m: "Method resetPage does not exist"

**≈òe≈°en√≠:** P≈ôidej `use WithPagination;` do Livewire komponenty.

### Probl√©m: Badge barvy se neaplikuj√≠

**≈òe≈°en√≠:**
1. P≈ôidej barvy do Tailwind `safelist`
2. Spus≈• `npm run build`
3. Nepou≈æ√≠vej dynamick√© t≈ô√≠dy typu `bg-{{ $color }}-100`

### Probl√©m: `&` se zobrazuje jako `&amp;`

**≈òe≈°en√≠:** Odstra≈à `e()` z `formatValue()` - Blade `{{ }}` escapuje automaticky.

```php
// ≈†PATNƒö
return e($value);

// SPR√ÅVNƒö
return $value;
```

### Probl√©m: Filtry se nezobrazuj√≠ pod sloupci

**≈òe≈°en√≠:** Druh√Ω parametr filtru mus√≠ odpov√≠dat `field` sloupce:

```php
// SPR√ÅVNƒö
TextColumn::make('name'),
TextFilter::make('name_filter', 'name'),  // 'name' odpov√≠d√° field

// ≈†PATNƒö
TextColumn::make('name'),
TextFilter::make('name_filter', 'username'),  // Neshoduje se
```

---

## üìä P≈ô√≠klady pou≈æit√≠

### E-commerce objedn√°vky

```php
public function table(Table $table): Table
{
    return $table
        ->model(Order::with(['customer', 'items']))
        ->columns([
            TextColumn::make('order_number')
                ->label('ƒå√≠slo objedn√°vky')
                ->searchable()
                ->copyable(),
            
            TextColumn::make('customer.name')
                ->label('Z√°kazn√≠k')
                ->searchable(),
            
            BadgeColumn::make('status')
                ->colors([
                    'pending' => 'yellow',
                    'processing' => 'blue',
                    'completed' => 'green',
                    'cancelled' => 'red',
                ]),
            
            TextColumn::make('total')
                ->label('Celkem')
                ->format(fn($value) => number_format($value, 2) . ' Kƒç')
                ->sortable(),
            
            TextColumn::make('created_at')
                ->label('Datum')
                ->format(fn($value) => $value->format('d.m.Y'))
                ->sortable(),
        ])
        ->filters([
            SelectFilter::make('status_filter', 'status')
                ->options([
                    'pending' => 'ƒåekaj√≠c√≠',
                    'processing' => 'Zpracov√°v√° se',
                    'completed' => 'Dokonƒçeno',
                ]),
            
            DateFilter::make('from_date', 'created_at')
                ->operator('>='),
        ])
        ->groupBy('status')
        ->subRows('items', function ($items) {
            return view('tables.order-items', compact('items'))->render();
        })
        ->bulkActions([
            BulkAction::make('mark_shipped')
                ->label('Oznaƒçit jako odesl√°no')
                ->action(fn($records) => $records->each->update(['status' => 'shipped'])),
        ]);
}
```

### CRM kontakty

```php
public function table(Table $table): Table
{
    return $table
        ->model(Contact::with(['company', 'tags']))
        ->columns([
            ImageColumn::make('photo')
                ->circular()
                ->size('sm'),
            
            EditableColumn::make('name')
                ->inputType('text')
                ->rules('required'),
            
            EditableColumn::make('email')
                ->inputType('text')
                ->rules('required|email'),
            
            TextColumn::make('company.name')
                ->label('Spoleƒçnost'),
            
            BadgeColumn::make('lead_status')
                ->colors([
                    'new' => 'blue',
                    'contacted' => 'yellow',
                    'qualified' => 'green',
                    'lost' => 'red',
                ]),
        ])
        ->enableColumnToggle(true)
        ->enablePresets(true)
        ->liveUpdate(30);
}
```

---

## ü§ù Contributing

Pull requesty jsou v√≠t√°ny! Pro vƒõt≈°√≠ zmƒõny pros√≠m nejprve otev≈ôete issue.

## üìÑ License

MIT License

## üë®‚Äçüíª Autor

Vytvo≈ôeno s ‚ù§Ô∏è pro Laravel komunitu

---

## üîó Related Resources

- [Laravel Documentation](https://laravel.com/docs)
- [Livewire Documentation](https://livewire.laravel.com)
- [Tailwind CSS](https://tailwindcss.com)
- [Alpine.js](https://alpinejs.dev)

---

**Happy coding! üéâ**